<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enigma Wizard</title>
  <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <audio id="background-music" src="audio/background.mp3" autoplay loop></audio>

  <div class="fog-layer fog-back"></div>
  <div class="fog-layer fog-front"></div>
  <canvas id="matrixRain"></canvas>

  <div class="container">
    <h1>Enigma Wizard</h1>

    <div class="step active" id="step-1">
      <h2>Enigma 1: L'inizio del sentiero</h2>
      <div class="input-wrapper">
        <input type="password" id="answer-1" placeholder="Inserisci la risposta">
        <button class="eye-button" onclick="toggleVisibility('answer-1', this)">👁️</button>
      </div>
      <button onclick="checkAnswer(1, '75')">Continua</button>
    </div>

    <div class="step" id="step-2">
      <h2>Enigma 2: Il nome nascosto</h2>
      <div class="input-wrapper">
        <input type="password" id="answer-2" placeholder="Inserisci la risposta">
        <button class="eye-button" onclick="toggleVisibility('answer-2', this)">👁️</button>
      </div>
      <button onclick="checkAnswer(2, 'stanza delle necessita')">Continua</button>
    </div>

    <div class="step" id="step-3">
      <h2>Complimenti!</h2>
      <p>Hai completato tutti gli enigmi.</p>
    </div>
  </div>

  <div class="custom-alert hidden" id="custom-alert">
    <div class="custom-alert-box">
      Risposta errata. Riprova!
    </div>
  </div>

  <script>
    const music = document.getElementById('background-music');
    music.volume = 0.3;

    function checkAnswer(step, correct) {
      const input = document.getElementById(`answer-${step}`);
      const value = input.value.trim().toLowerCase();
      if (value === correct.toLowerCase()) {
        document.getElementById(`step-${step}`).classList.remove('active');
        const nextStep = document.getElementById(`step-${step + 1}`);
        if (nextStep) {
          nextStep.classList.add('active');
        }
      } else {
        showAlert();
      }
    }

    function showAlert() {
      const alertBox = document.getElementById('custom-alert');
      alertBox.classList.remove('hidden');
      setTimeout(() => alertBox.classList.add('hidden'), 2000);
    }

    function toggleVisibility(id, btn) {
      const input = document.getElementById(id);
      if (input.type === 'password') {
        input.type = 'text';
      } else {
        input.type = 'password';
      }
    }

    // Matrix Rain Effect
    const canvas = document.getElementById('matrixRain');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    const letters = Array(256).join("1").split("");

    function draw() {
      ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#0F0";
      letters.forEach((y_pos, index) => {
        const text = String.fromCharCode(3e4 + Math.random() * 33);
        const x_pos = index * 10;
        ctx.fillText(text, x_pos, y_pos);
        letters[index] = y_pos > canvas.height + Math.random() * 1e4 ? 0 : y_pos + 10;
      });
    }
    setInterval(draw, 33);
  </script>
</body>
</html>
